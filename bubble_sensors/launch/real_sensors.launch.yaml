launch:

  - arg:
      name: use_dvl
      default: "true"

  - arg:
      name: use_imu
      default: "false"

  - arg:
      name: use_ekf
      default: "true"

  - node:
      pkg: vectornav
      exec: vectornav
      output: screen
      param:
        - from: $(find-pkg-share bubble_sensors)/config/vectornav.yaml
  
  - node:
      pkg: vectornav
      exec: vn_sensor_msgs
      output: screen
      param:
        - from: $(find-pkg-share bubble_sensors)/config/vectornav.yaml

  - node:
      pkg: dvl_a50
      if: $(var use_dvl)
      exec: dvl_a50_sensor
      output: screen
      param:
        - name: ip_address
          value: 192.168.194.95

  - node: 
      pkg: bubble_sensors
      if: $(var use_dvl)
      exec: dvl_message_converter
      param: 
        - name: input_topic
          value: "dvl/data"
        - name: output_topic
          value: "/dvl/data_twist"

  # Define the transformations from the base link into the dvl and imu frames
  - node:
      pkg: tf2_ros
      exec: static_transform_publisher
      name: base_link_to_dvl
      args: --x 0.0 --y 0.0 --z -0.2 --roll 0.0 --pitch 3.14159 --yaw 0.0 --frame-id base_link --child-frame-id dvl_a50

  - node:
      pkg: tf2_ros
      exec: static_transform_publisher
      name: base_link_to_vn100
      args: --x 0.0 --y 0.0 --z 0.1 --roll 0.0 --pitch 0.0 --yaw 0.0 --frame-id base_link --child-frame-id vectornav 

  - include:
      if: $(var use_ekf)
      file: $(find-pkg-share bubble_sensors)/launch/real_ekf.launch.py
